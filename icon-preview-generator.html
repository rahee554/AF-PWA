<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AF-PWA Icon Generator & Preview | artflow-studio/pwa</title>
    <link rel="stylesheet" href="icon-generator-styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>🚀 AF-PWA Icon Generator</h1>
                <p>Upload your logo and generate all PWA icons with live preview across devices</p>
                <div class="package-info">composer require artflow-studio/pwa</div>
            </div>
        </div>

        .content {
            padding: 40px;
        }

        .upload-section {
            background: #f8f9fa;
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 40px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .upload-section:hover {
            border-color: #007bff;
            background: #e7f3ff;
        }

        .upload-section.dragover {
            border-color: #007bff;
            background: #e7f3ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #6c757d;
        }

        .upload-section h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #495057;
        }

        .upload-section p {
            color: #6c757d;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .upload-btn:hover {
            background: #0056b3;
        }

        .current-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin: 20px auto;
            display: block;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .control-group:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .control-group h4 {
            margin-bottom: 20px;
            color: #495057;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .control-row label {
            flex: 1;
            font-weight: 500;
            color: #495057;
            min-width: 100px;
        }

        .control-row input,
        .control-row select {
            flex: 1.5;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
        }

        .control-row input:focus,
        .control-row select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .range-value {
            min-width: 50px;
            font-weight: 600;
            color: #007bff;
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .icon-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .icon-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .icon-preview {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .icon-preview img,
        .icon-preview canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .icon-info {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .icon-size {
            font-weight: 600;
            color: #495057;
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .icon-type {
            font-size: 0.75rem;
            color: #007bff;
            background: #e7f3ff;
            padding: 2px 8px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: inline-block;
        }

        .device-preview {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .device {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        .device:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .device h4 {
            margin-bottom: 20px;
            color: #495057;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .device-screen {
            margin: 0 auto 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .iphone-screen {
            width: 180px;
            height: 320px;
            border-radius: 24px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .android-screen {
            width: 160px;
            height: 280px;
            border-radius: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .desktop-screen {
            width: 200px;
            height: 130px;
            border-radius: 8px;
            background: linear-gradient(135deg, #434343, #000);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .device-icon {
            border-radius: 15px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .iphone-screen .device-icon {
            width: 70px;
            height: 70px;
            border-radius: 15px;
        }

        .android-screen .device-icon {
            width: 65px;
            height: 65px;
            border-radius: 12px;
        }

        .desktop-screen .device-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
        }

        .device-icon img {
            width: 85%;
            height: 85%;
            object-fit: contain;
        }

        .app-name {
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .splash-preview {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .splash-screen {
            width: 120px;
            height: 220px;
            margin: 0 auto;
            border-radius: 20px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .splash-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .splash-icon img {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }

        .splash-title {
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 10px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .download-section {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 35px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .download-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
            opacity: 0.5;
        }

        .download-content {
            position: relative;
            z-index: 1;
        }

        .download-section h3 {
            margin-bottom: 25px;
            font-size: 1.6rem;
            font-weight: 600;
        }

        .download-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .download-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .download-btn:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .feature {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .feature:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .feature h4 {
            margin-bottom: 10px;
            color: #495057;
            font-weight: 600;
        }

        .feature p {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #007bff;
            color: white;
            padding: 15px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .status-indicator.processing {
            background: #ffc107;
            color: #000;
        }

        .status-indicator.success {
            background: #28a745;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .icon-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .device-grid {
                grid-template-columns: 1fr;
            }
            
            .download-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 PWA Icon Generator</h1>
            <p>Upload your logo and generate all PWA icons with live preview across devices</p>
        </div>

        <div class="content">
            <!-- Upload Section -->
            <div class="upload-section" id="uploadSection" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">📁</div>
                <h3>Upload Your Logo</h3>
                <p>Drag & drop your logo here or click to browse<br>
                   Supports: PNG, JPG, SVG, ICO, WebP</p>
                <button class="upload-btn" type="button">Choose File</button>
                <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
                <div id="currentImagePreview" class="hidden">
                    <img id="currentImage" class="current-image" alt="Current logo">
                </div>
            </div>

            <!-- Controls -->
            <div class="controls" id="controlsSection" style="display: none;">
                <div class="control-group">
                    <h4>🎨 Icon Styling</h4>
                    <div class="control-row">
                        <label>Background:</label>
                        <select id="backgroundType">
                            <option value="transparent">Transparent</option>
                            <option value="solid">Solid Color</option>
                            <option value="gradient">Gradient</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <label>Background Color:</label>
                        <input type="color" id="backgroundColor" value="#ffffff">
                    </div>
                    <div class="control-row">
                        <label>Padding:</label>
                        <input type="range" id="padding" min="0" max="40" value="10">
                        <span id="paddingValue">10%</span>
                    </div>
                </div>

                <div class="control-group">
                    <h4>📐 Icon Properties</h4>
                    <div class="control-row">
                        <label>Border Radius:</label>
                        <input type="range" id="borderRadius" min="0" max="50" value="0">
                        <span id="borderRadiusValue">0%</span>
                    </div>
                    <div class="control-row">
                        <label>Shadow:</label>
                        <input type="checkbox" id="addShadow">
                    </div>
                    <div class="control-row">
                        <label>Quality:</label>
                        <select id="quality">
                            <option value="0.9">High (90%)</option>
                            <option value="1.0" selected>Maximum (100%)</option>
                        </select>
                    </div>
                </div>

                <div class="control-group">
                    <h4>🏷️ App Information</h4>
                    <div class="control-row">
                        <label>App Name:</label>
                        <input type="text" id="appName" value="My PWA App" placeholder="Your App Name">
                    </div>
                    <div class="control-row">
                        <label>Short Name:</label>
                        <input type="text" id="shortName" value="PWA" placeholder="Short Name">
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar hidden" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Icon Grid -->
            <div id="iconGrid" class="icon-grid" style="display: none;">
                <!-- Icons will be generated here -->
            </div>

            <!-- Device Preview -->
            <div class="device-preview" id="devicePreview" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 30px; color: #495057;">📱 Device Preview</h3>
                <div class="device-grid">
                    <div class="device">
                        <h4>📱 iPhone</h4>
                        <div class="device-screen">
                            <div class="iphone-screen">
                                <div class="device-icon" id="iphoneIcon">
                                    <img src="" alt="App Icon">
                                </div>
                                <div class="app-name" id="iphoneAppName">My PWA App</div>
                            </div>
                        </div>
                    </div>

                    <div class="device">
                        <h4>🤖 Android</h4>
                        <div class="device-screen">
                            <div class="android-screen">
                                <div class="device-icon" id="androidIcon">
                                    <img src="" alt="App Icon">
                                </div>
                                <div class="app-name" id="androidAppName">My PWA App</div>
                            </div>
                        </div>
                    </div>

                    <div class="device">
                        <h4>🖥️ Desktop</h4>
                        <div class="device-screen">
                            <div class="desktop-screen">
                                <div class="device-icon" id="desktopIcon">
                                    <img src="" alt="App Icon">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Download Section -->
            <div class="download-section" id="downloadSection" style="display: none;">
                <h3>📦 Download Your PWA Icons</h3>
                <p>All icons have been generated and are ready for your PWA!</p>
                
                <div class="download-buttons">
                    <button class="download-btn" onclick="downloadAllIcons()">
                        📁 Download All Icons (.zip)
                    </button>
                    <button class="download-btn" onclick="downloadManifest()">
                        📄 Download Manifest.json
                    </button>
                    <button class="download-btn" onclick="copyManifestCode()">
                        📋 Copy Laravel Config
                    </button>
                    <button class="download-btn" onclick="generatePreviewHTML()">
                        🌐 Generate Preview HTML
                    </button>
                </div>
            </div>

            <!-- Features -->
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">⚡</div>
                    <h4>Lightning Fast</h4>
                    <p>Generate all PWA icons in seconds with optimized quality</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">🎨</div>
                    <h4>Customizable</h4>
                    <p>Adjust colors, padding, shadows, and styling to match your brand</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">📱</div>
                    <h4>All Devices</h4>
                    <p>Preview how your icons look across iPhone, Android, and Desktop</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">📦</div>
                    <h4>Ready to Use</h4>
                    <p>Download complete icon package with manifest.json and Laravel config</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        let currentImage = null;
        let generatedIcons = {};
        
        // PWA icon sizes for different platforms
        const iconSizes = [
            { size: 16, name: 'favicon-16x16.png', desc: 'Browser Favicon' },
            { size: 32, name: 'favicon-32x32.png', desc: 'Browser Favicon' },
            { size: 48, name: 'icon-48x48.png', desc: 'Windows Taskbar' },
            { size: 72, name: 'icon-72x72.png', desc: 'Android Small' },
            { size: 96, name: 'icon-96x96.png', desc: 'Android Medium' },
            { size: 128, name: 'icon-128x128.png', desc: 'Chrome Web Store' },
            { size: 144, name: 'icon-144x144.png', desc: 'Android High' },
            { size: 152, name: 'icon-152x152.png', desc: 'iPad Touch' },
            { size: 180, name: 'apple-touch-icon.png', desc: 'Apple Touch Icon' },
            { size: 192, name: 'icon-192x192.png', desc: 'Android Chrome' },
            { size: 384, name: 'icon-384x384.png', desc: 'Android Splash' },
            { size: 512, name: 'icon-512x512.png', desc: 'Android Large' },
            { size: 192, name: 'maskable-icon-192x192.png', desc: 'Android Maskable', maskable: true },
            { size: 512, name: 'maskable-icon-512x512.png', desc: 'Android Maskable Large', maskable: true }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            updateControls();
        });

        function initializeEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadSection = document.getElementById('uploadSection');
            
            // File input change
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop
            uploadSection.addEventListener('dragover', handleDragOver);
            uploadSection.addEventListener('dragleave', handleDragLeave);
            uploadSection.addEventListener('drop', handleDrop);
            
            // Control changes
            document.getElementById('backgroundType').addEventListener('change', generateIcons);
            document.getElementById('backgroundColor').addEventListener('change', generateIcons);
            document.getElementById('padding').addEventListener('input', updateControls);
            document.getElementById('borderRadius').addEventListener('input', updateControls);
            document.getElementById('addShadow').addEventListener('change', generateIcons);
            document.getElementById('appName').addEventListener('input', updateAppInfo);
            document.getElementById('shortName').addEventListener('input', updateAppInfo);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                loadImage(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                loadImage(files[0]);
            }
        }

        function loadImage(file) {
            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    currentImage = img;
                    showImagePreview(e.target.result);
                    document.getElementById('controlsSection').style.display = 'grid';
                    generateIcons();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function showImagePreview(src) {
            const preview = document.getElementById('currentImagePreview');
            const img = document.getElementById('currentImage');
            img.src = src;
            preview.classList.remove('hidden');
        }

        function updateControls() {
            const padding = document.getElementById('padding').value;
            const borderRadius = document.getElementById('borderRadius').value;
            
            document.getElementById('paddingValue').textContent = padding + '%';
            document.getElementById('borderRadiusValue').textContent = borderRadius + '%';
            
            if (currentImage) {
                generateIcons();
            }
        }

        function updateAppInfo() {
            const appName = document.getElementById('appName').value;
            const shortName = document.getElementById('shortName').value;
            
            document.getElementById('iphoneAppName').textContent = shortName || appName;
            document.getElementById('androidAppName').textContent = shortName || appName;
        }

        async function generateIcons() {
            if (!currentImage) return;

            showProgress(0);
            const iconGrid = document.getElementById('iconGrid');
            iconGrid.innerHTML = '';
            iconGrid.style.display = 'grid';
            
            generatedIcons = {};

            for (let i = 0; i < iconSizes.length; i++) {
                const iconConfig = iconSizes[i];
                const progress = ((i + 1) / iconSizes.length) * 100;
                
                const canvas = await createIcon(iconConfig);
                generatedIcons[iconConfig.name] = canvas;
                
                addIconToGrid(canvas, iconConfig);
                updateProgress(progress);
                
                // Update device previews
                if (iconConfig.size === 180) {
                    updateDeviceIcon('iphoneIcon', canvas.toDataURL());
                }
                if (iconConfig.size === 192) {
                    updateDeviceIcon('androidIcon', canvas.toDataURL());
                }
                if (iconConfig.size === 128) {
                    updateDeviceIcon('desktopIcon', canvas.toDataURL());
                }
                
                // Small delay to prevent blocking
                await new Promise(resolve => setTimeout(resolve, 10));
            }

            hideProgress();
            document.getElementById('devicePreview').style.display = 'block';
            document.getElementById('downloadSection').style.display = 'block';
            updateAppInfo();
        }

        async function createIcon(config) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const size = config.size;
            
            canvas.width = size;
            canvas.height = size;

            // Get settings
            const backgroundType = document.getElementById('backgroundType').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            const padding = parseInt(document.getElementById('padding').value);
            const borderRadius = parseInt(document.getElementById('borderRadius').value);
            const addShadow = document.getElementById('addShadow').checked;

            // Clear canvas
            ctx.clearRect(0, 0, size, size);

            // Create clipping path for rounded corners
            if (borderRadius > 0) {
                const radius = (size * borderRadius) / 100;
                ctx.beginPath();
                ctx.roundRect(0, 0, size, size, radius);
                ctx.clip();
            }

            // Draw background
            if (backgroundType !== 'transparent') {
                if (backgroundType === 'solid') {
                    ctx.fillStyle = backgroundColor;
                    ctx.fillRect(0, 0, size, size);
                } else if (backgroundType === 'gradient') {
                    const gradient = ctx.createLinearGradient(0, 0, size, size);
                    gradient.addColorStop(0, backgroundColor);
                    gradient.addColorStop(1, adjustColor(backgroundColor, -20));
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, size, size);
                }
            }

            // Calculate image dimensions with padding
            const paddingPx = (size * padding) / 100;
            const imageSize = size - (paddingPx * 2);
            const imageX = paddingPx;
            const imageY = paddingPx;

            // Add shadow if enabled
            if (addShadow && backgroundType !== 'transparent') {
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = size * 0.02;
                ctx.shadowOffsetY = size * 0.01;
            }

            // Draw the image
            ctx.drawImage(currentImage, imageX, imageY, imageSize, imageSize);

            // For maskable icons, add safe zone indicator
            if (config.maskable) {
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                ctx.shadowOffsetY = 0;
                
                // Add subtle safe zone overlay
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                const safeZone = size * 0.8;
                const safeOffset = (size - safeZone) / 2;
                ctx.strokeRect(safeOffset, safeOffset, safeZone, safeZone);
            }

            return canvas;
        }

        function addIconToGrid(canvas, config) {
            const iconCard = document.createElement('div');
            iconCard.className = 'icon-card';
            
            const iconPreview = document.createElement('div');
            iconPreview.className = 'icon-preview';
            iconPreview.appendChild(canvas.cloneNode(true));
            
            const iconInfo = document.createElement('div');
            iconInfo.className = 'icon-info';
            iconInfo.textContent = config.desc;
            
            const iconSize = document.createElement('div');
            iconSize.className = 'icon-size';
            iconSize.textContent = `${config.size}×${config.size}px`;
            
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'download-btn';
            downloadBtn.style.background = '#28a745';
            downloadBtn.style.fontSize = '0.8rem';
            downloadBtn.style.padding = '8px 12px';
            downloadBtn.textContent = '📥 Download';
            downloadBtn.onclick = () => downloadSingleIcon(canvas, config.name);
            
            iconCard.appendChild(iconPreview);
            iconCard.appendChild(iconSize);
            iconCard.appendChild(iconInfo);
            iconCard.appendChild(downloadBtn);
            
            document.getElementById('iconGrid').appendChild(iconCard);
        }

        function updateDeviceIcon(elementId, dataURL) {
            const img = document.querySelector(`#${elementId} img`);
            img.src = dataURL;
        }

        function downloadSingleIcon(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        }

        async function downloadAllIcons() {
            const zip = new JSZip();
            const iconsFolder = zip.folder('pwa-icons');
            
            for (const [filename, canvas] of Object.entries(generatedIcons)) {
                const dataURL = canvas.toDataURL('image/png', 1.0);
                const base64Data = dataURL.split(',')[1];
                iconsFolder.file(filename, base64Data, { base64: true });
            }
            
            // Add manifest.json
            const manifest = generateManifestJSON();
            zip.file('manifest.json', JSON.stringify(manifest, null, 2));
            
            // Add Laravel config
            const laravelConfig = generateLaravelConfig();
            zip.file('af-pwa-icons-config.php', laravelConfig);
            
            // Add README
            const readme = generateReadme();
            zip.file('README.md', readme);
            
            const blob = await zip.generateAsync({ type: 'blob' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'pwa-icons-package.zip';
            link.click();
        }

        function downloadManifest() {
            const manifest = generateManifestJSON();
            const blob = new Blob([JSON.stringify(manifest, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'manifest.json';
            link.click();
        }

        function copyManifestCode() {
            const config = generateLaravelConfig();
            navigator.clipboard.writeText(config).then(() => {
                showSuccess('Laravel configuration copied to clipboard!');
            });
        }

        function generatePreviewHTML() {
            const html = generatePreviewHTMLContent();
            const blob = new Blob([html], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'pwa-icon-preview.html';
            link.click();
        }

        function generateManifestJSON() {
            const appName = document.getElementById('appName').value;
            const shortName = document.getElementById('shortName').value;
            
            return {
                name: appName,
                short_name: shortName,
                description: "A Progressive Web Application",
                start_url: "/",
                display: "standalone",
                background_color: "#ffffff",
                theme_color: "#007bff",
                orientation: "portrait-primary",
                scope: "/",
                icons: iconSizes.filter(icon => !icon.maskable).map(icon => ({
                    src: `/icons/${icon.name}`,
                    sizes: `${icon.size}x${icon.size}`,
                    type: "image/png",
                    purpose: "any"
                })).concat(iconSizes.filter(icon => icon.maskable).map(icon => ({
                    src: `/icons/${icon.name}`,
                    sizes: `${icon.size}x${icon.size}`,
                    type: "image/png",
                    purpose: "maskable"
                })))
            };
        }

        function generateLaravelConfig() {
            const appName = document.getElementById('appName').value;
            const shortName = document.getElementById('shortName').value;
            
            const iconsConfig = iconSizes.map(icon => {
                return `        [
            'src' => '/icons/${icon.name}',
            'sizes' => '${icon.size}x${icon.size}',
            'type' => 'image/png'${icon.maskable ? `,
            'purpose' => 'maskable'` : ''}
        ]`;
            }).join(',\n');
            
            return `<?php
// AF-PWA Icon Configuration
// Generated by AF-PWA Icon Generator

return [
    'name' => '${appName}',
    'short_name' => '${shortName}',
    'description' => 'A Progressive Web Application',
    'start_url' => '/',
    'display' => 'standalone',
    'background_color' => '#ffffff',
    'theme_color' => '#007bff',
    'orientation' => 'portrait-primary',
    'scope' => '/',
    
    'icons' => [
${iconsConfig}
    ],
    
    // Add these to your existing af-pwa.php config file
    // or merge with your current configuration
];`;
        }

        function generateReadme() {
            return `# PWA Icons Package

This package contains all the necessary icons for your Progressive Web Application.

## Installation

1. Copy all icon files to your \`public/icons/\` directory
2. Update your \`config/af-pwa.php\` with the provided configuration
3. Ensure your manifest.json includes the icon definitions

## Icons Included

${iconSizes.map(icon => `- ${icon.name} (${icon.size}×${icon.size}px) - ${icon.desc}`).join('\n')}

## Usage with AF-PWA

Simply add the configuration to your \`config/af-pwa.php\` file and the package will automatically use these icons.

## Manual Installation

If you're not using AF-PWA, copy the manifest.json to your public directory and reference it in your HTML:

\`\`\`html
<link rel="manifest" href="/manifest.json">
\`\`\`

Generated by AF-PWA Icon Generator
https://github.com/artflow-studio/af-pwa`;
        }

        function generatePreviewHTMLContent() {
            const appName = document.getElementById('appName').value;
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${appName} - PWA Icon Preview</title>
    <style>
        body { 
            font-family: system-ui, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .icon-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .icon-card { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            text-align: center; 
        }
        .icon-preview { 
            width: 80px; 
            height: 80px; 
            margin: 0 auto 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        h1 { color: #333; text-align: center; }
        h2 { color: #666; margin-top: 30px; }
    </style>
</head>
<body>
    <h1>${appName} - PWA Icons</h1>
    <p>Preview of all generated PWA icons for your application.</p>
    
    <h2>All Icons</h2>
    <div class="icon-grid">
        ${iconSizes.map(icon => `
        <div class="icon-card">
            <div class="icon-preview">
                <img src="icons/${icon.name}" alt="${icon.desc}" style="width: 100%; height: 100%; object-fit: contain;">
            </div>
            <strong>${icon.size}×${icon.size}px</strong><br>
            <small>${icon.desc}</small>
        </div>
        `).join('')}
    </div>
    
    <h2>Installation</h2>
    <p>Place all icon files in your <code>public/icons/</code> directory and update your PWA configuration.</p>
';
        }

        function showProgress(percentage) {
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            progressBar.classList.remove('hidden');
            progressFill.style.width = percentage + '%';
        }

        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
        }

        function hideProgress() {
            const progressBar = document.getElementById('progressBar');
            setTimeout(() => {
                progressBar.classList.add('hidden');
            }, 500);
        }

        function showError(message) {
            const error = document.createElement('div');
            error.className = 'error';
            error.textContent = message;
            document.querySelector('.content').insertBefore(error, document.querySelector('.content').firstChild);
            setTimeout(() => error.remove(), 5000);
        }

        function showSuccess(message) {
            const success = document.createElement('div');
            success.className = 'success';
            success.textContent = message;
            document.querySelector('.content').insertBefore(success, document.querySelector('.content').firstChild);
            setTimeout(() => success.remove(), 3000);
        }

        function adjustColor(color, amount) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * amount);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }
    </script>
</body>
</html>
